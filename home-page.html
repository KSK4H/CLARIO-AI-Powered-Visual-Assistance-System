<!doctype html>
<html lang="en" class="h-100">

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.responsivevoice.org/responsivevoice.js"></script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CLARIO- a helper!</title>

  <link rel="icon" href="/static/clario.jpeg" type="image/x-icon">
</head>

<body class="text-center text-dark bg-warning">

<!-- ================= HEADER ================= -->

<header class="cover-container d-flex flex-column text-white py-0" style="background-color:#1C2833;">
  <div class="mx-3 mt-3 mb-1" style="height:70px;">

    <div class="hover-target" onmouseover="startSpeaking(this)" onmouseout="stopSpeaking()">
      <h2 class="float-md-start mb-0 fw-bold display-5">CLARIO.</h2>
    </div>

    <img class="d-block mx-auto mb-4 float-md-start" src="/static/topleft.png" width="100" height="60">

    <nav class="nav nav-masthead justify-content-center float-md-end">

      <button class="btn btn-light px-3 me-md-3 fw-bold"
        onmouseover="startSpeaking(this)" onmouseout="stopSpeaking()">
        <a class="nav-link text-dark" href="/about">About</a>
      </button>

      <button class="btn btn-light px-3 fw-bold"
        onmouseover="startSpeaking(this)" onmouseout="stopSpeaking()">
        <a class="nav-link text-dark" href="/contact">Contact</a>
      </button>

    </nav>
  </div>
</header>

<div style="height:80px;"></div>

<!-- ================= MAIN ================= -->

<main>

  <!-- INTRO -->
  <div class="container rounded-3 border shadow-lg" style="background-color:#fcf3cf;width:950px;">
    <div style="height:50px;"></div>

    <p class="display-4 fw-bold">See the World,<br>Hear the Words.</p>
    <h2 class="display-7">A Helper for the Visually Impaired.</h2>

    <div class="mx-5">
      <p class="lead">
        CLARIO empowers visually impaired people by describing surroundings using a camera.
      </p>
    </div>

    <div style="height:30px;"></div>

    <!-- ðŸŽ¤ VOICE ASSISTANT BUTTON -->
    <button
      onclick="startVoiceAssistant()"
      onmouseover="speakVoiceAssistant()"
      onmouseout="stopSpeaking()"
      class="btn btn-dark btn-lg fw-bold">
      ðŸŽ¤ Voice Assistant
    </button>

    <div style="height:40px;"></div>
  </div>

  <div style="height:50px;"></div>

  <!-- FEATURES -->
  <div class="container my-5">
    <div class="row p-4 align-items-center rounded-3 border shadow-lg" style="background-color:#fcf3cf;">

      <div class="col-lg-7 p-3">

        <h1 class="display-4 fw-bold">let us help you with ...</h1>
        <p class="lead">Text recognition, object detection and audio output.</p>

        <div style="height:40px;"></div>

        <div class="container rounded-3 border shadow-lg" style="background-color:#D68910;color:#FDEBD0;width:360px;height:80px;">
          <a href="/text" class="list-group-item d-flex gap-3 py-3">
            <img src="/static/text.png" width="38" height="38" class="rounded-circle">
            <h2 class="mb-0 hover-target"
              onmouseover="startSpeaking(this)"
              onmouseout="stopSpeaking()">detect text</h2>
          </a>
        </div>

        <div style="height:30px;"></div>

        <div class="container rounded-3 border shadow-lg" style="background-color:#D68910;color:#FDEBD0;width:360px;height:80px;">
          <a href="/object" class="list-group-item d-flex gap-3 py-3">
            <img src="/static/object.png" width="38" height="38" class="rounded-circle">
            <h2 class="mb-0 hover-target"
              onmouseover="startSpeaking(this)"
              onmouseout="stopSpeaking()">detect images</h2>
          </a>
        </div>

        <div style="height:30px;"></div>

        <div class="container rounded-3 border shadow-lg" style="background-color:#D68910;color:#FDEBD0;width:360px;height:80px;">
          <a href="/color-detect" class="list-group-item d-flex gap-3 py-3">
            <img src="/static/object.png" width="38" height="38" class="rounded-circle">
            <h2 class="mb-0 hover-target"
              onmouseover="startSpeaking(this)"
              onmouseout="stopSpeaking()">detect object color</h2>
          </a>
        </div>

      </div>

      <div class="col-lg-4 p-0 mb-5 overflow-hidden">
        <img src="/static/cmen.png" width="500" height="500">
      </div>

    </div>
  </div>

</main>

<!-- ================= SCRIPT ================= -->

<script>
let isSpeechPlaying = false;

/* Hover speech */
function startSpeaking(el){
  if(!isSpeechPlaying){
    responsiveVoice.speak(el.textContent, 'UK English Female', { rate: 0.7 });
    isSpeechPlaying = true;
  }
}

function stopSpeaking(){
  responsiveVoice.cancel();
  isSpeechPlaying = false;
}

/* Hover voice assistant */
function speakVoiceAssistant(){
  if(!isSpeechPlaying){
    responsiveVoice.speak("Voice Assistant", "UK English Male", { rate: 0.8 });
    isSpeechPlaying = true;
  }
}

/* Click voice assistant (FIXED) */
function startVoiceAssistant() {

  // Stop any hover speech first
  responsiveVoice.cancel();
  isSpeechPlaying = false;

  // Speak activation message
  responsiveVoice.speak(
    "Voice assistant activated. Please say your command.",
    "UK English Male",
    { rate: 0.8 }
  );

  // Call backend AFTER speech finishes
  setTimeout(() => {
    fetch('/voice-assistant')
      .then(res => res.text())
      .then(data => console.log(data));
  }, 2500); // delay prevents overlap
}
</script>

</body>
</html>
